!function(){"use strict";!function(){const t=document.createElement("script");t.type="module",t.src="https://cdn.jsdelivr.net/npm/deep-chat@latest/dist/deepChat.min.js",document.head.appendChild(t),t.onload=async()=>{const t=document.querySelector("script[data-token]"),e=t?.getAttribute("data-token"),n=t?.getAttribute("data-primary-color")||"#007bff",o=t?.getAttribute("data-header-text-color")||"white",a=t?.getAttribute("data-button-text-color")||"white",i=t?.getAttribute("data-api-url")?.replace(/\/+$/,"")||"https://app.voice-ai.co.nz/api/v1",r=t?.getAttribute("data-logo-url")||null;if(!e)return void console.error("Missing Bearer token in data-token attribute");const s=document.createElement("div");s.id="chatWidgetContainer",s.style="\n            position:fixed;\n            bottom:20px;\n            right:20px;\n            width:400px;\n            background:white;\n            border-radius:10px;\n            box-shadow:0 0 10px rgba(0,0,0,0.3);\n            z-index:10000;\n            font-family:sans-serif;\n            ",document.body.appendChild(s);const d=r?`<img src="${r}" alt="Chat Logo" style="height:24px;margin-right:10px;vertical-align:middle;">`:"";s.innerHTML=`\n            <div id="chatForm" style="height:100%;display:flex;flex-direction:column;">\n                <div style="\n                background:${n};\n                color:${o};\n                padding:15px 20px;\n                font-size:18px;\n                font-weight:bold;\n                border-top-left-radius:10px;\n                border-top-right-radius:10px;\n                display:flex;\n                align-items:center;\n                ">\n                ${d} <span>Chat with Us</span>\n                </div>\n                <div style="padding:20px;flex-grow:1;display:flex;flex-direction:column;">\n                <input type="text" id="chatName" placeholder="Your name" style="padding:8px;margin-bottom:10px;" />\n                <input type="email" id="chatEmail" placeholder="Your email" style="padding:8px;margin-bottom:10px;" />\n                <button id="chatStartBtn" style="padding:10px;width:100%;background:${n};color:${a};border:none;border-radius:5px;cursor:pointer;">Start Chat</button>\n                </div>\n            </div>\n            `,document.getElementById("chatStartBtn").addEventListener("click",async()=>{const t=document.getElementById("chatName").value.trim(),n=document.getElementById("chatEmail").value.trim();if(t&&n)try{const o=await fetch(`${i}/bots/sessions/start-text`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({metadata:{name:t,email:n}})}),a=(await o.json()).session_id;if(!a)return void console.error("Failed to retrieve session_id");s.innerHTML="";const r=document.createElement("deep-chat");r.style="width:100%;height:100%;display:flex;",s.appendChild(r),r.connect={handler:async(t,n)=>{try{const o=t.messages[0].text,r=encodeURIComponent(o),s=await fetch(`${i}/bots/sessions/${a}/send-message?message=${r}&use_rag=true`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),d=await s.json();n.onResponse({text:d.response||d.message||"[No response]"})}catch(t){console.error("Chat handler error:",t),n.onResponse({error:"Something went wrong while fetching the response."})}}}}catch(t){console.error("Error starting chat session:",t)}else alert("Please enter both name and email.")})}}()}();
