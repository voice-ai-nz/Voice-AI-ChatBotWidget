!function(){"use strict";!function(){const e=document.createElement("script");e.type="module",e.src="https://cdn.jsdelivr.net/npm/deep-chat@latest/dist/deepChat.min.js",document.head.appendChild(e),e.onload=async()=>{const e=document.querySelector("script[data-token]"),t=e?.getAttribute("data-token");e?.getAttribute("data-primary-color"),e?.getAttribute("data-button-text-color");const n=e?.getAttribute("data-api-url")?.replace(/\/+$/,"")||"https://app.voice-ai.co.nz/api/v1";if(!t)return void console.error("Missing Bearer token in data-token attribute");const o=document.createElement("button");o.id="openChatBtn",o.innerText="ðŸ’¬",o.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        border: none;\n        background-color: #007bff;\n        color: white;\n        font-size: 24px;\n        cursor: pointer;\n        box-shadow: 0 4px 8px rgba(0,0,0,0.2);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: background-color 0.3s ease, transform 0.15s ease;\n        ",document.body.appendChild(o);const s=document.createElement("div");s.id="chatWidgetContainer",s.style="\n        position: fixed;\n        bottom: 80px;\n        right: 20px;\n        width: 400px;\n        max-height: 500px;\n        background: white;\n        border-radius: 10px;\n        box-shadow: 0 0 10px rgba(0,0,0,0.3);\n        z-index: 10000;\n        font-family: sans-serif;\n        overflow: hidden;\n        height: 0;\n        opacity: 0;\n        transition: height 0.3s ease, opacity 0.3s ease;\n        display: flex;\n        flex-direction: column;\n        ",document.body.appendChild(s);let i=!1,r=null,a=!1;o.addEventListener("click",async()=>{if(o.style.transform="scale(0.9)",setTimeout(()=>{o.style.transform="scale(1)"},150),a=!a,o.innerText=a?"â–¾":"ðŸ’¬",a?(s.style.height="500px",s.style.opacity="1"):(s.style.height="0px",s.style.opacity="0"),!i)try{const e=await fetch(`${n}/bots/sessions/start-text`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({metadata:{}})}),o=await e.json();if(r=o.session_id,!r)return void console.error("Failed to retrieve session_id");s.innerHTML="";const a=document.createElement("deep-chat");a.style="width:100%;height:100%;display:flex;",a.history=[{text:"Hi there, you're speaking with AI Agent. How can I help you?",role:"ai"}],a.avatars=!0,s.appendChild(a),a.connect={handler:async(e,o)=>{try{const s=e.messages[0].text,i=encodeURIComponent(s),a=await fetch(`${n}/bots/sessions/${r}/send-message?message=${i}&use_rag=true`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),c=await a.json();o.onResponse({text:c.response||c.message||"[No response]"})}catch(e){console.error("Chat handler error:",e),o.onResponse({error:"Something went wrong while fetching the response."})}}},i=!0,requestAnimationFrame(()=>{s.style.height="500px",s.style.opacity="1"})}catch(e){console.error("Error starting chat session:",e)}})}}()}();
