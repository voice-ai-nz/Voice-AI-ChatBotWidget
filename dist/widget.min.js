!function(){"use strict";!function(){const e=document.createElement("script");e.type="module",e.src="https://cdn.jsdelivr.net/npm/deep-chat@latest/dist/deepChat.min.js",document.head.appendChild(e),e.onload=async()=>{const e=document.querySelector("script[data-token]"),t=e?.getAttribute("data-token"),n=e?.getAttribute("data-primary-color")||"#007bff";if(!t)return void console.error("Missing Bearer token in data-token attribute");const o=document.createElement("div");o.id="chatWidgetContainer",o.style="\n        position:fixed;\n        bottom:20px;\n        right:20px;\n        width:400px;\n        background:white;\n        border-radius:10px;\n        box-shadow:0 0 10px rgba(0,0,0,0.3);\n        z-index:10000;\n        font-family:sans-serif;\n    ",document.body.appendChild(o),o.innerHTML=`\n        <div id="chatForm" style="height:100%;display:flex;flex-direction:column;">\n        <div style="\n        background:${n};\n        color:white;\n        padding:15px 20px;\n        font-size:18px;\n        font-weight:bold;\n        border-top-left-radius:10px;\n        border-top-right-radius:10px;\n        ">\n        Chat with US\n        </div>\n        <div style="padding:20px;flex-grow:1;display:flex;flex-direction:column;">\n        <input type="text" id="chatName" placeholder="Your name" style="width:100%;padding:8px;margin-bottom:10px;" />\n        <input type="email" id="chatEmail" placeholder="Your email" style="width:100%;padding:8px;margin-bottom:10px;" />\n        <button id="chatStartBtn" style="padding:10px;width:100%;background:${n};color:white;border:none;border-radius:5px;cursor:pointer;">Start Chat</button>\n        </div>\n    </div>\n    `,document.getElementById("chatStartBtn").addEventListener("click",async()=>{const e=document.getElementById("chatName").value.trim(),n=document.getElementById("chatEmail").value.trim();if(e&&n)try{const i=await fetch("http://localhost:8001/api/v1/bots/sessions/start-text",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({metadata:{name:e,email:n}})}),a=(await i.json()).session_id;if(!a)return void console.error("Failed to retrieve session_id");o.innerHTML="";const r=document.createElement("deep-chat");r.style="width:100%;height:100%;display: flex;",o.appendChild(r),r.connect={handler:async(e,n)=>{try{const o=e.messages[0].text,i=encodeURIComponent(o),r=await fetch(`http://localhost:8001/api/v1/bots/sessions/${a}/send-message?message=${i}&use_rag=true`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),s=await r.json();n.onResponse({text:s.response||s.message||"[No response]"})}catch(e){console.error("Chat handler error:",e),n.onResponse({error:"Something went wrong while fetching the response."})}}}}catch(e){console.error("Error starting chat session:",e)}else alert("Please enter both name and email.")})}}()}();
